function r(r, f) {
    var o;
    r > f && (o = r, r = f, f = o), o = f, o *= f, o += f, o >>= 1, R[o += r] = 1;
}

function f(f, o) {
    var e;
    for (F[f + s * o] = 1, e = -2; e < 2; e++) F[f + e + s * (o - 2)] = 1, F[f - 2 + s * (o + e + 1)] = 1, 
    F[f + 2 + s * (o + e)] = 1, F[f + e + 1 + s * (o + 2)] = 1;
    for (e = 0; e < 2; e++) r(f - 1, o + e), r(f + 1, o - e), r(f - e, o - 1), r(f + e, o + 1);
}

function o(r) {
    for (;r >= 255; ) r = ((r -= 255) >> 8) + (255 & r);
    return r;
}

function e(r, f, e, i) {
    var a, t, c;
    for (a = 0; a < i; a++) y[e + a] = 0;
    for (a = 0; a < f; a++) {
        if (255 != (c = w[y[r + a] ^ y[e]])) for (t = 1; t < i; t++) y[e + t - 1] = y[e + t] ^ x[o(c + A[i - t])]; else for (t = e; t < e + i; t++) y[t] = y[t + 1];
        y[e + i - 1] = 255 == c ? 0 : x[o(c + A[0])];
    }
}

function i(r, f) {
    var o;
    return r > f && (o = r, r = f, f = o), o = f, o += f * f, o >>= 1, o += r, R[o];
}

function a(r) {
    var f, o, e, a;
    switch (r) {
      case 0:
        for (o = 0; o < s; o++) for (f = 0; f < s; f++) f + o & 1 || i(f, o) || (F[f + o * s] ^= 1);
        break;

      case 1:
        for (o = 0; o < s; o++) for (f = 0; f < s; f++) 1 & o || i(f, o) || (F[f + o * s] ^= 1);
        break;

      case 2:
        for (o = 0; o < s; o++) for (e = 0, f = 0; f < s; f++, e++) 3 == e && (e = 0), e || i(f, o) || (F[f + o * s] ^= 1);
        break;

      case 3:
        for (a = 0, o = 0; o < s; o++, a++) for (3 == a && (a = 0), e = a, f = 0; f < s; f++, 
        e++) 3 == e && (e = 0), e || i(f, o) || (F[f + o * s] ^= 1);
        break;

      case 4:
        for (o = 0; o < s; o++) for (e = 0, a = o >> 1 & 1, f = 0; f < s; f++, e++) 3 == e && (e = 0, 
        a = !a), a || i(f, o) || (F[f + o * s] ^= 1);
        break;

      case 5:
        for (a = 0, o = 0; o < s; o++, a++) for (3 == a && (a = 0), e = 0, f = 0; f < s; f++, 
        e++) 3 == e && (e = 0), (f & o & 1) + !(!e | !a) || i(f, o) || (F[f + o * s] ^= 1);
        break;

      case 6:
        for (a = 0, o = 0; o < s; o++, a++) for (3 == a && (a = 0), e = 0, f = 0; f < s; f++, 
        e++) 3 == e && (e = 0), (f & o & 1) + (e && e == a) & 1 || i(f, o) || (F[f + o * s] ^= 1);
        break;

      case 7:
        for (a = 0, o = 0; o < s; o++, a++) for (3 == a && (a = 0), e = 0, f = 0; f < s; f++, 
        e++) 3 == e && (e = 0), (e && e == a) + (f + o & 1) & 1 || i(f, o) || (F[f + o * s] ^= 1);
    }
}

function t(r) {
    var f, o = 0;
    for (f = 0; f <= r; f++) S[f] >= 5 && (o += P + S[f] - 5);
    for (f = 3; f < r - 1; f += 2) S[f - 2] == S[f + 2] && S[f + 2] == S[f - 1] && S[f - 1] == S[f + 1] && 3 * S[f - 1] == S[f] && (0 == S[f - 3] || f + 3 > r || 3 * S[f - 3] >= 4 * S[f] || 3 * S[f + 3] >= 4 * S[f]) && (o += j);
    return o;
}

function c() {
    var r, f, o, e, i, a = 0, c = 0;
    for (f = 0; f < s - 1; f++) for (r = 0; r < s - 1; r++) (F[r + s * f] && F[r + 1 + s * f] && F[r + s * (f + 1)] && F[r + 1 + s * (f + 1)] || !(F[r + s * f] || F[r + 1 + s * f] || F[r + s * (f + 1)] || F[r + 1 + s * (f + 1)])) && (a += W);
    for (f = 0; f < s; f++) {
        for (S[0] = 0, o = e = r = 0; r < s; r++) (i = F[r + s * f]) == e ? S[o]++ : S[++o] = 1, 
        c += (e = i) ? 1 : -1;
        a += t(o);
    }
    c < 0 && (c = -c);
    var l = c, n = 0;
    for (l += l << 2, l <<= 1; l > s * s; ) l -= s * s, n++;
    for (a += n * q, r = 0; r < s; r++) {
        for (S[0] = 0, o = e = f = 0; f < s; f++) (i = F[r + s * f]) == e ? S[o]++ : S[++o] = 1, 
        e = i;
        a += t(o);
    }
    return a;
}

function l(t) {
    var l, S, P, W, j, q, z, B;
    W = t.length, n = 0;
    do {
        if (n++, P = 4 * (m - 1) + 16 * (n - 1), v = p[P++], u = p[P++], d = p[P++], b = p[P], 
        P = d * (v + u) + u - 3 + (n <= 9), W <= P) break;
    } while (n < 40);
    for (s = 17 + 4 * n, j = d + (d + b) * (v + u) + u, W = 0; W < j; W++) C[W] = 0;
    for (y = t.slice(0), W = 0; W < s * s; W++) F[W] = 0;
    for (W = 0; W < (s * (s + 1) + 1) / 2; W++) R[W] = 0;
    for (W = 0; W < 3; W++) {
        for (P = 0, S = 0, 1 == W && (P = s - 7), 2 == W && (S = s - 7), F[S + 3 + s * (P + 3)] = 1, 
        l = 0; l < 6; l++) F[S + l + s * P] = 1, F[S + s * (P + l + 1)] = 1, F[S + 6 + s * (P + l)] = 1, 
        F[S + l + 1 + s * (P + 6)] = 1;
        for (l = 1; l < 5; l++) r(S + l, P + 1), r(S + 1, P + l + 1), r(S + 5, P + l), r(S + l + 1, P + 5);
        for (l = 2; l < 4; l++) F[S + l + s * (P + 2)] = 1, F[S + 2 + s * (P + l + 1)] = 1, 
        F[S + 4 + s * (P + l)] = 1, F[S + l + 1 + s * (P + 4)] = 1;
    }
    if (n > 1) for (W = k[n], S = s - 7; ;) {
        for (l = s - 7; l > W - 3 && (f(l, S), !(l < W)); ) l -= W;
        if (S <= W + 9) break;
        f(6, S -= W), f(S, 6);
    }
    for (F[8 + s * (s - 8)] = 1, S = 0; S < 7; S++) r(7, S), r(s - 8, S), r(7, S + s - 7);
    for (l = 0; l < 8; l++) r(l, 7), r(l + s - 8, 7), r(l, s - 8);
    for (l = 0; l < 9; l++) r(l, 8);
    for (l = 0; l < 8; l++) r(l + s - 8, 8), r(8, l);
    for (S = 0; S < 7; S++) r(8, S + s - 7);
    for (l = 0; l < s - 14; l++) 1 & l ? (r(8 + l, 6), r(6, 8 + l)) : (F[8 + l + 6 * s] = 1, 
    F[6 + s * (8 + l)] = 1);
    if (n > 6) for (W = h[n - 7], P = 17, l = 0; l < 6; l++) for (S = 0; S < 3; S++, 
    P--) 1 & (P > 11 ? n >> P - 12 : W >> P) ? (F[5 - l + s * (2 - S + s - 11)] = 1, 
    F[2 - S + s - 11 + s * (5 - l)] = 1) : (r(5 - l, 2 - S + s - 11), r(2 - S + s - 11, 5 - l));
    for (S = 0; S < s; S++) for (l = 0; l <= S; l++) F[l + s * S] && r(l, S);
    for (j = y.length, q = 0; q < j; q++) C[q] = y.charCodeAt(q);
    if (y = C.slice(0), l = d * (v + u) + u, j >= l - 2 && (j = l - 2, n > 9 && j--), 
    q = j, n > 9) {
        for (y[q + 2] = 0, y[q + 3] = 0; q--; ) W = y[q], y[q + 3] |= 255 & W << 4, y[q + 2] = W >> 4;
        y[2] |= 255 & j << 4, y[1] = j >> 4, y[0] = 64 | j >> 12;
    } else {
        for (y[q + 1] = 0, y[q + 2] = 0; q--; ) W = y[q], y[q + 2] |= 255 & W << 4, y[q + 1] = W >> 4;
        y[1] |= 255 & j << 4, y[0] = 64 | j >> 4;
    }
    for (q = j + 3 - (n < 10); q < l; ) y[q++] = 236, y[q++] = 17;
    for (A[0] = 1, q = 0; q < b; q++) {
        for (A[q + 1] = 1, z = q; z > 0; z--) A[z] = A[z] ? A[z - 1] ^ x[o(w[A[z]] + q)] : A[z - 1];
        A[0] = x[o(w[A[0]] + q)];
    }
    for (q = 0; q <= b; q++) A[q] = w[A[q]];
    for (P = l, S = 0, q = 0; q < v; q++) e(S, d, P, b), S += d, P += b;
    for (q = 0; q < u; q++) e(S, d + 1, P, b), S += d + 1, P += b;
    for (S = 0, q = 0; q < d; q++) {
        for (z = 0; z < v; z++) C[S++] = y[q + z * d];
        for (z = 0; z < u; z++) C[S++] = y[v * d + q + z * (d + 1)];
    }
    for (z = 0; z < u; z++) C[S++] = y[v * d + q + z * (d + 1)];
    for (q = 0; q < b; q++) for (z = 0; z < v + u; z++) C[S++] = y[l + q + z * b];
    for (y = C, l = S = s - 1, P = j = 1, B = (d + b) * (v + u) + u, q = 0; q < B; q++) for (W = y[q], 
    z = 0; z < 8; z++, W <<= 1) {
        128 & W && (F[l + s * S] = 1);
        do {
            j ? l-- : (l++, P ? 0 != S ? S-- : (P = !P, 6 == (l -= 2) && (l--, S = 9)) : S != s - 1 ? S++ : (P = !P, 
            6 == (l -= 2) && (l--, S -= 8))), j = !j;
        } while (i(l, S));
    }
    for (y = F.slice(0), W = 0, S = 3e4, P = 0; P < 8 && (a(P), (l = c()) < S && (S = l, 
    W = P), 7 != W); P++) F = y.slice(0);
    for (W != P && a(W), S = g[W + (m - 1 << 3)], P = 0; P < 8; P++, S >>= 1) 1 & S && (F[s - 1 - P + 8 * s] = 1, 
    P < 6 ? F[8 + s * P] = 1 : F[8 + s * (P + 1)] = 1);
    for (P = 0; P < 7; P++, S >>= 1) 1 & S && (F[8 + s * (s - 7 + P)] = 1, P ? F[6 - P + 8 * s] = 1 : F[7 + 8 * s] = 1);
    return F;
}

var n, s, v, u, d, b, k = [ 0, 11, 15, 19, 23, 27, 31, 16, 18, 20, 22, 24, 26, 28, 20, 22, 24, 24, 26, 28, 28, 22, 24, 24, 26, 26, 28, 28, 24, 24, 26, 26, 26, 28, 28, 24, 26, 26, 26, 28, 28 ], h = [ 3220, 1468, 2713, 1235, 3062, 1890, 2119, 1549, 2344, 2936, 1117, 2583, 1330, 2470, 1667, 2249, 2028, 3780, 481, 4011, 142, 3098, 831, 3445, 592, 2517, 1776, 2234, 1951, 2827, 1070, 2660, 1345, 3177 ], g = [ 30660, 29427, 32170, 30877, 26159, 25368, 27713, 26998, 21522, 20773, 24188, 23371, 17913, 16590, 20375, 19104, 13663, 12392, 16177, 14854, 9396, 8579, 11994, 11245, 5769, 5054, 7399, 6608, 1890, 597, 3340, 2107 ], p = [ 1, 0, 19, 7, 1, 0, 16, 10, 1, 0, 13, 13, 1, 0, 9, 17, 1, 0, 34, 10, 1, 0, 28, 16, 1, 0, 22, 22, 1, 0, 16, 28, 1, 0, 55, 15, 1, 0, 44, 26, 2, 0, 17, 18, 2, 0, 13, 22, 1, 0, 80, 20, 2, 0, 32, 18, 2, 0, 24, 26, 4, 0, 9, 16, 1, 0, 108, 26, 2, 0, 43, 24, 2, 2, 15, 18, 2, 2, 11, 22, 2, 0, 68, 18, 4, 0, 27, 16, 4, 0, 19, 24, 4, 0, 15, 28, 2, 0, 78, 20, 4, 0, 31, 18, 2, 4, 14, 18, 4, 1, 13, 26, 2, 0, 97, 24, 2, 2, 38, 22, 4, 2, 18, 22, 4, 2, 14, 26, 2, 0, 116, 30, 3, 2, 36, 22, 4, 4, 16, 20, 4, 4, 12, 24, 2, 2, 68, 18, 4, 1, 43, 26, 6, 2, 19, 24, 6, 2, 15, 28, 4, 0, 81, 20, 1, 4, 50, 30, 4, 4, 22, 28, 3, 8, 12, 24, 2, 2, 92, 24, 6, 2, 36, 22, 4, 6, 20, 26, 7, 4, 14, 28, 4, 0, 107, 26, 8, 1, 37, 22, 8, 4, 20, 24, 12, 4, 11, 22, 3, 1, 115, 30, 4, 5, 40, 24, 11, 5, 16, 20, 11, 5, 12, 24, 5, 1, 87, 22, 5, 5, 41, 24, 5, 7, 24, 30, 11, 7, 12, 24, 5, 1, 98, 24, 7, 3, 45, 28, 15, 2, 19, 24, 3, 13, 15, 30, 1, 5, 107, 28, 10, 1, 46, 28, 1, 15, 22, 28, 2, 17, 14, 28, 5, 1, 120, 30, 9, 4, 43, 26, 17, 1, 22, 28, 2, 19, 14, 28, 3, 4, 113, 28, 3, 11, 44, 26, 17, 4, 21, 26, 9, 16, 13, 26, 3, 5, 107, 28, 3, 13, 41, 26, 15, 5, 24, 30, 15, 10, 15, 28, 4, 4, 116, 28, 17, 0, 42, 26, 17, 6, 22, 28, 19, 6, 16, 30, 2, 7, 111, 28, 17, 0, 46, 28, 7, 16, 24, 30, 34, 0, 13, 24, 4, 5, 121, 30, 4, 14, 47, 28, 11, 14, 24, 30, 16, 14, 15, 30, 6, 4, 117, 30, 6, 14, 45, 28, 11, 16, 24, 30, 30, 2, 16, 30, 8, 4, 106, 26, 8, 13, 47, 28, 7, 22, 24, 30, 22, 13, 15, 30, 10, 2, 114, 28, 19, 4, 46, 28, 28, 6, 22, 28, 33, 4, 16, 30, 8, 4, 122, 30, 22, 3, 45, 28, 8, 26, 23, 30, 12, 28, 15, 30, 3, 10, 117, 30, 3, 23, 45, 28, 4, 31, 24, 30, 11, 31, 15, 30, 7, 7, 116, 30, 21, 7, 45, 28, 1, 37, 23, 30, 19, 26, 15, 30, 5, 10, 115, 30, 19, 10, 47, 28, 15, 25, 24, 30, 23, 25, 15, 30, 13, 3, 115, 30, 2, 29, 46, 28, 42, 1, 24, 30, 23, 28, 15, 30, 17, 0, 115, 30, 10, 23, 46, 28, 10, 35, 24, 30, 19, 35, 15, 30, 17, 1, 115, 30, 14, 21, 46, 28, 29, 19, 24, 30, 11, 46, 15, 30, 13, 6, 115, 30, 14, 23, 46, 28, 44, 7, 24, 30, 59, 1, 16, 30, 12, 7, 121, 30, 12, 26, 47, 28, 39, 14, 24, 30, 22, 41, 15, 30, 6, 14, 121, 30, 6, 34, 47, 28, 46, 10, 24, 30, 2, 64, 15, 30, 17, 4, 122, 30, 29, 14, 46, 28, 49, 10, 24, 30, 24, 46, 15, 30, 4, 18, 122, 30, 13, 32, 46, 28, 48, 14, 24, 30, 42, 32, 15, 30, 20, 4, 117, 30, 40, 7, 47, 28, 43, 22, 24, 30, 10, 67, 15, 30, 19, 6, 118, 30, 18, 31, 47, 28, 34, 34, 24, 30, 20, 61, 15, 30 ], w = [ 255, 0, 1, 25, 2, 50, 26, 198, 3, 223, 51, 238, 27, 104, 199, 75, 4, 100, 224, 14, 52, 141, 239, 129, 28, 193, 105, 248, 200, 8, 76, 113, 5, 138, 101, 47, 225, 36, 15, 33, 53, 147, 142, 218, 240, 18, 130, 69, 29, 181, 194, 125, 106, 39, 249, 185, 201, 154, 9, 120, 77, 228, 114, 166, 6, 191, 139, 98, 102, 221, 48, 253, 226, 152, 37, 179, 16, 145, 34, 136, 54, 208, 148, 206, 143, 150, 219, 189, 241, 210, 19, 92, 131, 56, 70, 64, 30, 66, 182, 163, 195, 72, 126, 110, 107, 58, 40, 84, 250, 133, 186, 61, 202, 94, 155, 159, 10, 21, 121, 43, 78, 212, 229, 172, 115, 243, 167, 87, 7, 112, 192, 247, 140, 128, 99, 13, 103, 74, 222, 237, 49, 197, 254, 24, 227, 165, 153, 119, 38, 184, 180, 124, 17, 68, 146, 217, 35, 32, 137, 46, 55, 63, 209, 91, 149, 188, 207, 205, 144, 135, 151, 178, 220, 252, 190, 97, 242, 86, 211, 171, 20, 42, 93, 158, 132, 60, 57, 83, 71, 109, 65, 162, 31, 45, 67, 216, 183, 123, 164, 118, 196, 23, 73, 236, 127, 12, 111, 246, 108, 161, 59, 82, 41, 157, 85, 170, 251, 96, 134, 177, 187, 204, 62, 90, 203, 89, 95, 176, 156, 169, 160, 81, 11, 245, 22, 235, 122, 117, 44, 215, 79, 174, 213, 233, 230, 231, 173, 232, 116, 214, 244, 234, 168, 80, 88, 175 ], x = [ 1, 2, 4, 8, 16, 32, 64, 128, 29, 58, 116, 232, 205, 135, 19, 38, 76, 152, 45, 90, 180, 117, 234, 201, 143, 3, 6, 12, 24, 48, 96, 192, 157, 39, 78, 156, 37, 74, 148, 53, 106, 212, 181, 119, 238, 193, 159, 35, 70, 140, 5, 10, 20, 40, 80, 160, 93, 186, 105, 210, 185, 111, 222, 161, 95, 190, 97, 194, 153, 47, 94, 188, 101, 202, 137, 15, 30, 60, 120, 240, 253, 231, 211, 187, 107, 214, 177, 127, 254, 225, 223, 163, 91, 182, 113, 226, 217, 175, 67, 134, 17, 34, 68, 136, 13, 26, 52, 104, 208, 189, 103, 206, 129, 31, 62, 124, 248, 237, 199, 147, 59, 118, 236, 197, 151, 51, 102, 204, 133, 23, 46, 92, 184, 109, 218, 169, 79, 158, 33, 66, 132, 21, 42, 84, 168, 77, 154, 41, 82, 164, 85, 170, 73, 146, 57, 114, 228, 213, 183, 115, 230, 209, 191, 99, 198, 145, 63, 126, 252, 229, 215, 179, 123, 246, 241, 255, 227, 219, 171, 75, 150, 49, 98, 196, 149, 55, 110, 220, 165, 87, 174, 65, 130, 25, 50, 100, 200, 141, 7, 14, 28, 56, 112, 224, 221, 167, 83, 166, 81, 162, 89, 178, 121, 242, 249, 239, 195, 155, 43, 86, 172, 69, 138, 9, 18, 36, 72, 144, 61, 122, 244, 245, 247, 243, 251, 235, 203, 139, 11, 22, 44, 88, 176, 125, 250, 233, 207, 131, 27, 54, 108, 216, 173, 71, 142, 0 ], y = [], C = [], F = [], R = [], S = [], m = 2, A = [], P = 3, W = 3, j = 40, q = 10, z = {
    fill: function(r) {
        var f = r.string, o = r.ctx, e = r.cavW, i = void 0 === e ? 100 : e, a = (r.ecc, 
        r.left), t = void 0 === a ? 0 : a, c = r.top, n = void 0 === c ? 0 : c, v = r.color, u = void 0 === v ? "#000000" : v, d = r.bgColor, b = void 0 === d ? "#ffffff" : d, k = r.padding, h = void 0 === k ? 0 : k;
        if (o) {
            var g = l(f), p = (i - 2 * h) / s;
            o.translate(t, n), o.clearRect(0, 0, i, i), o.setFillStyle(b), o.fillRect(0, 0, i, i), 
            o.beginPath(), o.setFillStyle(u);
            for (var w = 0; w < s; w++) for (var x = 0; x < s; x++) g[x * s + w] && o.rect(p * w + h, p * x + h, p, p);
            o.fill(), o.translate(-t, -n);
        }
    }
};

module.exports = {
    fill: z.fill
};